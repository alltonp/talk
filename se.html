<!-- Ghetto Slides. A basic slide deck for the lazy (like me).
     Feel free to copy, modify, rip-off, etc, but please credit me in the source somewhere.
     Joe Walnes, http://joewalnes.com -->

<!-- Added backwards navigation and not running off the end support.
     Paul Allton, paulallton@gmail.com -->

<!-- TODO:
   add key support back
-->

<!-- TIP:
    http://htmlpreview.github.io/?https://raw.githubusercontent.com/alltonp/talk/master/se.html
-->

<!-- The plan:
- Check
- Action
- Where's my trade?

Mention shoreditch
-->

<!-- D1
@startuml

skinparam sequence {
	ArrowColor #428bca
	LifeLineBorderColor #999999

	ParticipantFontColor #428bca
        ParticipantFontStyle bold
	ParticipantBorderColor #000000
	ParticipantBackgroundColor #FFFFFF
}

participant app1
participant app2
participant app3
participant app4
participant app5

app1<->app5: super wide
|||
app2<->app4: wide
|||
app3<->app4: narrow

hide footbox

@enduml
-->

<!-- probate
http://localhost:8473,/demo/failure,PROD,Unable To Price Trade,,Email Support,3
http://localhost:8473,/demo/success,PROD,There Are Rejected Trades,,Email Support,3
http://localhost:8473,/demo/success,PROD,Not All Trades Cleared,,Email Support,3
http://localhost:8473,/demo/success,PROD,Today's Trade Report Invalid,,Email Support,3
-->

<!DOCTYPE HTML>
<html>
<head>
    <script src="js/jquery-1.4.3.min.js"></script>
    <style>
        body { color: #000000; background-color: #ffffff; font-family: arial; font-size: 50px; -webkit-user-select: none; }
        section { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; text-align: center; padding-top: 25px; }
        t1 { display: block; color: #428bca; font-size: 125%; padding-bottom: 20px;}
        t2 { color: #999; }
        pre { margin: 40px; text-align: left; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; color: #000000; background-color: #eee;font-size: 30px;border: 1px dashed #999999;padding: 5px 5px 5px 5px; overflow: auto; width: 90%; }
        img { float:centre; }
        li { margin: 25px; text-align: left;}
    </style>
    <script>
        $(function(event) {
        previous = function() {
        if (currentSection.prev().size() != 0) {
        currentSection = currentSection.fadeOut().prev().fadeIn();
        } else {
        currentSection.fadeOut();
        currentSection = $('sections').find('section').last().fadeIn();
        }
        return false;
        };

        next = function() {
        if (currentSection.next().size() != 0) {
        currentSection = currentSection.fadeOut().next().fadeIn();
        } else {
        currentSection.fadeOut();
        currentSection = $('sections').find('section').first().fadeIn();
        }
        };

        //hack right might mouse
        document.oncontextmenu = previous;

        var startAt = 0 //TODO: read from url?
        var currentSection = $('sections').find('section').eq(startAt).fadeIn();
        $('body').bind('click keypress', function(event) {
        if (event.which == '44' || event.which == '3') { // < or right mouse for previous
        previous();
        } else {
        next();
        }
        });
        });

    </script>
    <title>??? - ???</title>
</head>
<body oncontextmenu="return false;">
<!--<img style="float:right; margin: 30px 30px;" src="img/logo.png"/>-->
<sections>

    <section>
        <t1>keeping it up</t1>
        <t2>without touching it</t2>
        <ul>
            <li>write-only security clearance</li> <!-- as CAS alluded - in the dark, write only access -->
            <li>business vs technical</li> <!-- to protect against classes of problem-->
            <!-- business not technical -->
            <!-- not disk, memory etc - that's already monitored -->
            <!-- so what are we interested in? business problems .... -->
        </ul>
    </section>

    <section>
        <t1>a trading system</t1>
        <br/>
        <p><t2>can price trade</t2></p>
        <p><t2>no trades rejected</t2></p>
        <p><t2>all trades cleared</t2></p>
        <p><t2>reports valid today</t2></p>
        <p><br/></p>
    </section>

    <section>
        <t1>a trading system</t1>
        <br/>
        <p><t2>can price trade</t2></p>
        <p><t2>no trades rejected</t2></p>
        <p><t2>all trades cleared</t2></p>
        <p><t2>reports valid today</t2></p>
        <p><br/></p>

        <ul>
            <li>already tested???</li>
            <!-- invariants of the system -->
            <!-- obviously every project has extensive suite of acceptance tests -->
            <!-- what does it mean 'all trades processed' -->
            <!-- logic is in the codebase for asserting that -->
            <!-- checking would mean repeating that logic -->
            <!-- we would be repeating ourselves -->
        </ul>
    </section>

    <section>
        <!--
            we've got a test for that, but tests only run as part of building/deploying the app
        -->
        <t1>assertions suck</t1>
        <!-- okay, thats strong, they don't suck but they haven't fulfilled their potential
            we go to all the effort to write tests, documenting the system invariants and then throw them away
            invariants, first class citizens, why not expose them
        -->
        <ul>
            <li>why only in tests?
            <li>why only run during dev and CI?
            <li>why hidden? <!-- are we ashamed of them? -->
            <li>why not all the time?
        </ul>
        <!--
            I want them running all the time, 1000's times per day
            we have already written them in our unit/acceptance tests
            why only executed at testing time?

            why not make an api?
            why not expose it via a restlike interface?
        -->
    </section>

    <section>
        <t1>a trading system</t1>
        <br/>
        <p>assert <t2>can price trade</t2></p>
        <p>assert <t2>no trades rejected</t2></p>
        <p>assert <t2>all trades cleared</t2></p>
        <p>assert <t2>reports valid today</t2></p>
        <p><br/></p>
        <ul>
            <li>why not expose them ...</li> <!-- make them 1st class citizens, in the production code -->
        </ul>
    </section>

    <section>
        <t1>a trading system</t1>
        <br/>
        <p><t2>assert/can/price/trade</t2></p>
        <p><t2>assert/no/trades/rejected</t2></p>
        <p><t2>assert/all/trades/cleared</t2></p>
        <p><t2>assert/reports/valid/today</t2></p>
        <p><br/></p>
        <ul>
            <li>... in a REST-like (tm) interface</li>
        </ul>

    </section>

    <section>
        <t1>check</t1> <!-- note that assert has changed to check, whatever -->
        <pre>   GET /check/trades/rejected/@count
   GET /check/trades/rejected/0</pre>

        <br/>
        <t2>Success</t2>
        <pre>   =>   {"failures":[]}</pre> <!-- the empty list -->

        <br/>
        <t2>Failure</t2>
        <!-- need to add a better failure message -->
        <pre>   =>   {"failures":[
           "2 trades rejected",
           "trade 1234 is rejected",
           "trade 5678 is rejected"
        ]}</pre>
    </section>

    <section>
        <t1>a trading system</t1>
        <br/>
        <p>http://pricing/<t2>check/can/price/trade</t2></p>
        <p>http://trading/<t2>check/no/trades/rejected</t2></p>
        <p>http://clearing/<t2>check/all/trades/cleared</t2></p>
        <p>http://reporting/<t2>check/reports/valid/today</t2></p>
        <p><br/></p>

        <ul>
            <li>... now we just need to run them ...</li>
        </ul>
    </section>

    <section>
        <t1>continuous checking</t1>
        <!-- need a mainly green set, with a single flip flopper -->
        <iframe width="90%" height="80%" frameborder="0" src="http://localhost:8473/"></iframe>
    </section>

    <section>
        <t1>problem #2</t1>
        <ul>
            <li>integration testing a suite of applications/services
            <li>... how do you know it works together?
        </ul>
        <!--
            here the scala compile helps us in some many ways
        -->
    </section>

    <section>
        <t1>diagram</t1>
        <img src="http://www.plantuml.com:80/plantuml/png/NP312i8m38RForC4F0iw9wY8e88d3u9Fq6rHYxEfMOUAyzrrSoZjVylt_KcXvLaRgqHTiAHhHIOZV4Aq5E7RcWiMx2Nn9CqKH5jzeAqsj6B9IJevRGCGxPGudMchZDkmSVukTWbAU_Se25CkSc_VUs3GnlSgEn-5AvDtdKqRU07OVmkLjSCGn24OXI09mHYWkJJlBvfXXcLbIV2cSuAwhXiNVrqoy-ZeHurgVXFWzB5uO7Oft-4D"/>
    </section>

    <!-- TODO: split the url and body into two pre chunks -->

    <section>
        <t1>action</t1>
        <pre>   POST /action/create/foo    =>    {"in":[
                                      {"name":"x", "value:":"y"}
                                    ]}</pre>
        <t2>Success</t2>
        <pre>   {"failures":[], "returnValue": "12345"}  //optional</pre>

        <t2>Failure</t2>
        <!-- need to add a better failure message -->
        <pre>   {"failures":["foo failed"]}</pre>
    </section>

    <section>
        <t1>example actions</t1>
    </section>

    <!--
        bring it altogether
        its just a case of assembling tests out of endpooints in a script
        and running it against an environment
    -->

    <section>
        <t1>bring it all together</t1>
        <!-- checks, actions and an engine to run -->
    </section>

    <!-- TODO: colourise the id -->

    <section>
        <t1>example tests</t1>
        <pre>   @id <= create trade in:x => notional:123
   check trade booked in:y => @id
   check trade cleared in:clearing => @id </pre>
    </section>

    <!-- need to explain what this maps to ... -->

    <section>
        <t1>shoreditch demo</t1>
        <!-- need to make the text on this bigger -->
        <iframe width="90%" height="80%" frameborder="0" src="http://localhost:4253/"></iframe>
    </section>

    <!--
        may not get this far
    -->

    <section>
        <t1>wheres my trade?</t1>
    </section>

    <section>
        <t1>problem #3,4,5 ...x</t1>
        <ul>
            <li>... how do you know it's quick enough?
            <li>... how do you know what your capacity is?
            <li>... how do you test long running workflows (i.e. days to execute, events T+x)?
            <li>... how do you break up a monolithic app into microservices?
        </ul>
    </section>

    <section>
        <t1>next  ....</t1>
    </section>

    <!-- its all the same, with checks and actions, it's just a case of assembling tests out of endpooints -->

    <!-- guff -->

    <!--
    what makes banks unique? - no access to production box, no logins to the app
    even though everything is fully TDD'd with rafts of acceptance tests, things still
    allowed to write the code, arent allowed to use it!
    -->


    <!-- /guff -->

</sections>
</body>
</html>
